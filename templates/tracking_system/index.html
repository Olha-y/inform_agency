{% extends "base.html" %}

{% block title %}
  <title>Editorial Dashboard | NTS</title>
{% endblock %}

{% block header %}
  <header class="header-2">
    <div class="page-header min-vh-50 relative" style="background-image: url('{{ ASSETS_ROOT }}/img/bg2.jpg')">
      <span class="mask bg-gradient-primary opacity-4"></span>
      <div class="container">
        <div class="row">
          <div class="col-lg-7 text-center mx-auto">
            <h1 class="text-white pt-3 mt-n5">Editorial Dashboard</h1>
            <p class="lead text-white mt-3">The system is focused on editorial control and monitoring of author activity.</p>
          </div>
        </div>
      </div>
    </div>
  </header>
{% endblock %}

{% block content %}
    <div class="card card-body blur shadow-blur mx-3 mx-md-4 mt-n6">
    <section class="pt-3 pb-4" id="count-stats">
      <div class="container">
        <div class="row">
          <div class="col-lg-9 mx-auto py-3">
            <div class="row">
              <div class="col-md-4 position-relative">
                <div class="p-3 text-center">
                  <h1 class="text-gradient text-primary"><span id="state1" countTo="{{ num_topics }}">0</span>+</h1>
                  <h5 class="mt-3">Topics</h5>
                  <p class="text-sm font-weight-normal">Art, Business, Crime, Politics, Trade, Weather</p>
                </div>
                <hr class="vertical dark">
              </div>
              <div class="col-md-4 position-relative">
                <div class="p-3 text-center">
                  <h1 class="text-gradient text-primary"> <span id="state2" countTo="{{ num_redactors }}">0</span>+</h1>
                  <h5 class="mt-3">Redactors</h5>
                  <p class="text-sm font-weight-normal">Our team</p>
                </div>
                <hr class="vertical dark">
              </div>
              <div class="col-md-4">
                <div class="p-3 text-center">
                  <h1 class="text-gradient text-primary" id="state3" countTo="{{ num_newspapers }}">0</h1>
                  <h5 class="mt-3">Newspapers</h5>
                  <p class="text-sm font-weight-normal">Our publications</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  <hr>
  <div class="container mt-5">
    <div class="row">
      <div class="col-lg-6 mx-auto">
        <h4 class="mb-4">Publications overview</h4>
          <table class="table table-sm table-bordered w-50">
            <thead class="thead-light">
              <tr>
                <th>Period</th>
                <th>Publications</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Today</td>
                <td>{{ newspapers_today }}</td>
                <td>
                  <a href="{% url 'tracking_system:newspaper-list' %}?period=today">
                    View
                  </a>
                </td>
              </tr>
              <tr>
                <td>Last 7 days</td>
                <td>{{ newspapers_week }}</td>
                <td>
                  <a href="{% url 'tracking_system:newspaper-list' %}?period=week">
                    View
                  </a>
                </td>
              </tr>
              <tr>
                <td>Last 30 days</td>
                <td>{{ newspapers_month }}</td>
                <td>
                  <a href="{% url 'tracking_system:newspaper-list' %}?period=month">
                    View
                  </a>
                </td>
              </tr>
            </tbody>
          </table>
      </div>
      </div>
  </div>
<hr>
<div class="container mt-5">
    <div class="row">
      <div class="col-lg-6 mx-auto">
        <h4 class="mb-4">Active redactors (last 7 days)</h4>
          <table class="table table-sm table-hover w-50">
            <thead class="thead-light">
              <tr>
                <th>Redactor</th>
                <th>Publications</th>
                <th>Profile</th>
              </tr>
            </thead>
            <tbody>
              {% for redactor in active_redactors %}
                <tr>
                  <td>{{ redactor.username }}</td>
                  <td>{{ redactor.newspapers.count }}</td>
                  <td>
                    <a href="{% url 'tracking_system:redactor-detail' redactor.id %}">
                      View
                    </a>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="3">No active redactors</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
      </div>
    </div>
</div>
<hr>
<div class="container mt-5">
    <div class="row">
      <div class="col-lg-6 mx-auto">
        <h4>Inactive redactors (no publications last 7 days)</h4>

        <table class="table table-sm table-hover w-50">
          <thead class="thead-light">
            <tr>
              <th>Redactor</th>
              <th>Profile</th>
            </tr>
          </thead>
          <tbody>
            {% for redactor in inactive_redactors %}
              <tr>
                <td>{{ redactor.username }}</td>
                <td>
                  <a href="{% url 'tracking_system:redactor-detail' redactor.id %}">
                    View
                  </a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="2">No inactive redactors</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
<a href="{% url 'tracking_system:redactor-list' %}">
  View all redactors →
</a>
</div>

<hr>
<div class="container mt-5">
    <div class="row">
      <div class="col-lg-6 mx-auto">
        <h4>Latest publications</h4>

        <table class="table table-sm table-striped">
          <thead class="thead-light">
            <tr>
              <th>Title</th>
              <th>Topic</th>
              <th>Authors</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {% for newspaper in latest_newspapers %}
              <tr>
                <td class="text-wrap" style="max-width: 250px;">
                  <a href="{% url 'tracking_system:newspaper-detail' newspaper.id %}">
                    {{ newspaper.title | truncatechars:100 }} }}
                  </a>
                </td>
                <td>{{ newspaper.topic.name }}</td>
                <td>
                  {% for publisher in newspaper.publishers.all %}
                    {{ publisher.username }}{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </td>
                <td>{{ newspaper.published_date|date:"Y-m-d H:i" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4">No publications yet</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
<a href="{% url 'tracking_system:newspaper-list' %}">
  View all publications →
</a>
</div>
    </section>
</div>
{% endblock %}
